---
title: "Experiment 1 Power Summary"
author: "Dave Braun"
date: "March 15, 2019"
output: 
  html_document:
    df_print: paged
    code_folding: hide
---

Summarizing the power analysis for Experiment 1.

```{r include = FALSE}
library(tidyverse)
d <- read.csv('powerAnalysis.csv')
```

```{r}
head(d)
```


```{r}
d <- d %>% 
  filter(n == 100) %>% 
  select(bias, avgEffectSize) %>% 
  rename(effectCode = avgEffectSize) %>% 
  inner_join(d) 
```


```{r}
d %>% 
  ggplot(aes(x = factor(n), y = factor(round(effectCode, 2)))) + geom_tile(aes(fill = power), color = 'white') + scale_fill_gradient(low = 'steelblue', high = 'red') +
  xlab('Sample Size') + ylab('Effect Size')
```

Based on these simulations, I should have full power to detect even a small effect with N = 40.


### Sample Experiment Simulation
Just for fun, we can look at the data from one simulated experiment. This simulation will be at N = 100 and effect size ~ 0.1.

```{r results = 'hide'}
source('powerSimulator.r')
d <- powerSimulator(n = 100, bias = 0.3, nSims = 1)
m1 <- ezANOVA(wid = subject, within = condition, dv = lowDemandSelection, data = d, detailed = TRUE)
effectSize <- m1$ANOVA$SSn[2] / (m1$ANOVA$SSn[2] + m1$ANOVA$SSd[2])
pValue <- m1$ANOVA$p[2]
```

```{r}
print(m1$ANOVA[2,])
print(paste('Effect Size:', effectSize))
```

I'm only plotting half of the subjects so the plot is a little easier to read.
```{r}
d %>%
  #filter(condition == 'nearHigh' | condition == 'nearLow') %>% 
  group_by(subject, condition) %>%
  summarize(lowDemandSelection = mean(lowDemandSelection)) %>%
  group_by(condition) %>%
  summarize(lds = mean(lowDemandSelection), se = sd(lowDemandSelection) / sqrt(n())) %>%
  ggplot(aes(x = condition, y = lds)) + geom_bar(stat = 'identity', width = .7) + ylim(0,1) + geom_errorbar(aes(ymin = lds - se, ymax = lds + se), width = 0.5) +
  ylim(0,1) +
  theme_bw() #+
  # theme(panel.grid.major = element_blank(), #panel.grid.minor = element_blank(),
  #       axis.text.x = element_blank(),
  #       axis.ticks = element_blank(),
  #       axis.title.y = element_blank())

#ggsave('barPlot.png', width = 5.5, height = 3.5, units = 'in')


## subject lines
d %>% 
 # filter(condition == 'nearHigh' | condition == 'nearLow') %>% 
  filter(subject %in% 1:50) %>% 
  group_by(subject, condition) %>% 
  summarize(lds = mean(lowDemandSelection)) %>% 
  ggplot(aes(x = condition, y = lds)) + #geom_boxplot(width = .5, alpha = .5, fatten = NULL) +
  #stat_summary(fun.y = mean, geom = "errorbar", aes(ymax = ..y.., ymin = ..y..),
              # width = 0.5, size = 1, linetype = "solid") +
  geom_line(aes(group = subject)) +
  ylim(0,1) +
  theme_bw() #+
  # theme(panel.grid.major = element_blank(), #panel.grid.minor = element_blank(),
  #       axis.text.x = element_blank(),
  #       axis.ticks = element_blank(),
  #       axis.title.y = element_blank())

#ggsave('boxPlot.png', width = 5.5, height = 3.5, units = 'in')
```

This looks pretty messy, but I think the variability is representative of what we'll see in the actual data.


